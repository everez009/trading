<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAU/USD Trading Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .db-status {
            position: absolute;
            top: 10px;
            right: 20px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }

        .db-connected {
            background: #28a745;
            color: white;
        }

        .db-disconnected {
            background: #dc3545;
            color: white;
        }

        .db-loading {
            background: #ffc107;
            color: #856404;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .config-section h3 {
            margin-bottom: 15px;
            color: #495057;
        }

        .config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .form-section h3 {
            margin-bottom: 20px;
            color: #495057;
            font-size: 1.4em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-success {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: 700;
        }

        .trades-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 14px;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .profit {
            color: #28a745;
            font-weight: 600;
        }

        .loss {
            color: #dc3545;
            font-weight: 600;
        }

        .neutral {
            color: #6c757d;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .view-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .view-btn:hover {
            background: #138496;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .signal-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .signal-buy {
            background: #d4edda;
            color: #155724;
        }

        .signal-sell {
            background: #f8d7da;
            color: #721c24;
        }

        .status-open {
            background: #fff3cd;
            color: #856404;
        }

        .status-won {
            background: #d4edda;
            color: #155724;
        }

        .status-lost {
            background: #f8d7da;
            color: #721c24;
        }

        .status-breakeven {
            background: #e2e3e5;
            color: #495057;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .detail-group h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6c757d;
        }

        .detail-value {
            color: #333;
        }

        .notes-section {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #bee5eb;
            margin-top: 20px;
        }

        .notes-section h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .performance-chart {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 18px;
        }

        .insights-section {
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .insights-section h4 {
            color: #0c5460;
            margin-bottom: 15px;
        }

        .insight-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .config-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="db-status" id="dbStatus">
                <span class="loading-spinner"></span>
                Connecting...
            </div>
            <h1>📊 XAU/USD Trading Journal</h1>
            <p>EMA 4/12 Crossover + Retracement Strategy Tracker</p>
        </div>

        <div class="config-section">
            <h3>🔧 Database Configuration</h3>
            <div class="config-grid">
                <div class="form-group">
                    <label>Supabase URL</label>
                    <input type="url" id="supabaseUrl" placeholder="">
                </div>
                <div class="form-group">
                    <label>Supabase Anon Key</label>
                    <input type="password" id="supabaseKey" placeholder="">
                </div>
                <div>
                    <button class="btn-primary" onclick="connectDatabase()">Connect Database</button>
                    <button class="btn-secondary" onclick="initializeDatabase()">Initialize Tables</button>
                </div>
            </div>
            <div id="dbAlert" style="margin-top: 15px;"></div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('trade-entry')">Trade Entry</button>
            <button class="nav-tab" onclick="showTab('open-trades')">Open Trades</button>
            <button class="nav-tab" onclick="showTab('closed-trades')">Closed Trades</button>
            <button class="nav-tab" onclick="showTab('performance')">Performance</button>
            <button class="nav-tab" onclick="showTab('insights')">Insights</button>
        </div>

        <div id="trade-entry" class="tab-content active">
            <div class="form-section">
                <h3 id="formTitle">📝 New Trade Entry</h3>
                <form id="tradeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="tradeDateTime" required>
                        </div>
                        <div class="form-group">
                            <label>Signal Type</label>
                            <select id="signalType" required>
                                <option value="">Select Signal</option>
                                <option value="buy">EMA 4 Cross Above EMA 12 (BUY)</option>
                                <option value="sell">EMA 4 Cross Below EMA 12 (SELL)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Entry Price</label>
                            <input type="number" id="entryPrice" step="0.01" placeholder="e.g., 2045.50" required>
                        </div>
                        <div class="form-group">
                            <label>Lot Size</label>
                            <input type="number" id="lotSize" step="0.01" placeholder="e.g., 0.05" required>
                        </div>
                        <div class="form-group">
                            <label>Stop Loss</label>
                            <input type="number" id="stopLoss" step="0.01" placeholder="e.g., 2025.50" required>
                        </div>
                        <div class="form-group">
                            <label>Take Profit</label>
                            <input type="number" id="takeProfit" step="0.01" placeholder="e.g., 2085.50" required>
                        </div>
                        <div class="form-group">
                            <label>Risk Amount ($)</label>
                            <input type="number" id="riskAmount" step="0.01" placeholder="e.g., 20.00" required>
                        </div>
                        <div class="form-group">
                            <label>Trade Status</label>
                            <select id="tradeStatus" required>
                                <option value="open">Open</option>
                                <option value="won">Won</option>
                                <option value="lost">Lost</option>
                                <option value="breakeven">Breakeven</option>
                            </select>
                        </div>
                        <div class="form-group" id="exitPriceGroup" style="display: none;">
                            <label>Exit Price</label>
                            <input type="number" id="exitPrice" step="0.01" placeholder="Actual exit price">
                        </div>
                        <div class="form-group" id="exitDateGroup" style="display: none;">
                            <label>Exit Date & Time</label>
                            <input type="datetime-local" id="exitDateTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Market Setup & Analysis</label>
                        <textarea id="marketSetup" placeholder="Describe the EMA crossover setup, trend direction, support/resistance levels, and any confluence factors..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Trade Notes</label>
                        <textarea id="tradeNotes" placeholder="Entry reasoning, market conditions, emotions, exit strategy..."></textarea>
                    </div>
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <span class="loading-spinner" id="submitSpinner" style="display: none;"></span>
                        Add Trade
                    </button>
                    <button type="button" class="btn-secondary" onclick="clearForm()">Clear Form</button>
                    <button type="button" class="btn-secondary" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">Cancel Edit</button>
                </form>
            </div>
        </div>

        <div id="open-trades" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Open Trades</h4>
                    <div class="value" id="openTradesCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Risk</h4>
                    <div class="value" id="totalRisk">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Potential Profit</h4>
                    <div class="value" id="potentialProfit">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Potential Loss</h4>
                    <div class="value" id="potentialLoss">$0.00</div>
                </div>
            </div>

            <div class="trades-table">
                <div class="table-controls">
                    <h3>📈 Open Positions</h3>
                    <button class="btn-success" onclick="exportToExcel('open')">📥 Export to Excel</button>
                </div>
                <table id="openTradesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Signal</th>
                            <th>Entry</th>
                            <th>Stop Loss</th>
                            <th>Take Profit</th>
                            <th>Lot Size</th>
                            <th>Risk ($)</th>
                            <th>R:R</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="openTradesTableBody">
                    </tbody>
                </table>
                <div id="openEmptyState" class="empty-state">
                    <h3>No open trades</h3>
                    <p>Add a new trade with status "Open" to see it here</p>
                </div>
            </div>
        </div>

        <div id="closed-trades" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Closed Trades</h4>
                    <div class="value" id="closedTradesCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Win Rate</h4>
                    <div class="value" id="winRate">0%</div>
                </div>
                <div class="stat-card">
                    <h4>Total P&L</h4>
                    <div class="value" id="totalPnL">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Best Trade</h4>
                    <div class="value" id="bestTrade">$0.00</div>
                </div>
            </div>

            <div class="trades-table">
                <div class="table-controls">
                    <h3>📊 Closed Positions</h3>
                    <div class="filter-group">
                        <label>Filter by Status:</label>
                        <select id="statusFilter" onchange="filterClosedTrades()">
                            <option value="all">All Closed</option>
                            <option value="won">Won Only</option>
                            <option value="lost">Lost Only</option>
                            <option value="breakeven">Breakeven Only</option>
                        </select>
                        <button class="btn-success" onclick="exportToExcel('closed')">📥 Export to Excel</button>
                    </div>
                </div>
                <table id="closedTradesTable">
                    <thead>
                        <tr>
                            <th>Entry Date</th>
                            <th>Exit Date</th>
                            <th>Signal</th>
                            <th>Entry</th>
                            <th>Exit</th>
                            <th>Lot Size</th>
                            <th>P&L</th>
                            <th>R:R</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="closedTradesTableBody">
                    </tbody>
                </table>
                <div id="closedEmptyState" class="empty-state">
                    <h3>No closed trades yet</h3>
                    <p>Complete some trades to see them here</p>
                </div>
            </div>
        </div>

        <div id="performance" class="tab-content">
            <div class="table-controls">
                <h3>📊 Performance Analysis</h3>
                <button class="btn-success" onclick="exportToExcel('performance')">📥 Export Performance to Excel</button>
            </div>
            
            <div class="chart-container">
                <h3>Equity Curve</h3>
                <div class="performance-chart" id="equityChart">
                    📈 Chart will appear here as you add trades
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Average Win</h4>
                    <div class="value" id="avgWin">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Average Loss</h4>
                    <div class="value" id="avgLoss">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Profit Factor</h4>
                    <div class="value" id="profitFactor">0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Max Drawdown</h4>
                    <div class="value" id="maxDrawdown">$0.00</div>
                </div>
            </div>
        </div>

        <div id="insights" class="tab-content">
            <div class="insights-section">
                <h4>🎯 Strategy Performance Insights</h4>
                <div id="insightsContainer">
                    <div class="insight-item">
                        <strong>EMA Crossover Analysis:</strong> Track how many crossover signals resulted in profitable trades vs. false signals
                    </div>
                    <div class="insight-item">
                        <strong>Time of Day Performance:</strong> Monitor which trading sessions (London, NY, Asian) provide the best EMA crossover signals
                    </div>
                    <div class="insight-item">
                        <strong>Risk Management:</strong> Ensure you're maintaining consistent risk per trade (typically 1-3% of account)
                    </div>
                    <div class="insight-item">
                        <strong>Market Conditions:</strong> Note whether trending or ranging markets produce better EMA crossover results
                    </div>
                </div>
            </div>

            <div class="insights-section">
                <h4>📊 Key Metrics to Monitor</h4>
                <div id="keyMetrics">
                    <div class="insight-item">
                        <strong>Target Win Rate:</strong> Aim for 55-65% win rate with 1:2 risk-reward ratio
                    </div>
                    <div class="insight-item">
                        <strong>Risk-Reward Ratio:</strong> Maintain consistent 1:2 or better on most trades
                    </div>
                    <div class="insight-item">
                        <strong>Maximum Consecutive Losses:</strong> Monitor streaks to adjust position sizing if needed
                    </div>
                    <div class="insight-item">
                        <strong>Monthly Performance:</strong> Track monthly returns to ensure consistent profitability
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Details Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Trade Details</h2>
            <div id="tradeDetailsContent">
                <!-- Trade details will be populated here -->
            </div>
        </div>
    </div>

    <script src="">
    <title>XAU/USD Trading Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }

        .form-section h3 {
            margin-bottom: 20px;
            color: #495057;
            font-size: 1.4em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-success {
            background: #28a745;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h4 {
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: 700;
        }

        .trades-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 14px;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .profit {
            color: #28a745;
            font-weight: 600;
        }

        .loss {
            color: #dc3545;
            font-weight: 600;
        }

        .neutral {
            color: #6c757d;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .edit-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .edit-btn:hover {
            background: #0056b3;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .view-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .view-btn:hover {
            background: #138496;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        .signal-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .signal-buy {
            background: #d4edda;
            color: #155724;
        }

        .signal-sell {
            background: #f8d7da;
            color: #721c24;
        }

        .status-open {
            background: #fff3cd;
            color: #856404;
        }

        .status-won {
            background: #d4edda;
            color: #155724;
        }

        .status-lost {
            background: #f8d7da;
            color: #721c24;
        }

        .status-breakeven {
            background: #e2e3e5;
            color: #495057;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: none;
            border-radius: 10px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .trade-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .detail-group h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6c757d;
        }

        .detail-value {
            color: #333;
        }

        .notes-section {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #bee5eb;
            margin-top: 20px;
        }

        .notes-section h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .performance-chart {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 18px;
        }

        .insights-section {
            background: #e7f3ff;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .insights-section h4 {
            color: #0c5460;
            margin-bottom: 15px;
        }

        .insight-item {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            table {
                font-size: 14px;
            }
            
            th, td {
                padding: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 XAU/USD Trading Journal</h1>
            <p>EMA 4/12 Crossover + Retracement Strategy Tracker</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('trade-entry')">Trade Entry</button>
            <button class="nav-tab" onclick="showTab('open-trades')">Open Trades</button>
            <button class="nav-tab" onclick="showTab('closed-trades')">Closed Trades</button>
            <button class="nav-tab" onclick="showTab('performance')">Performance</button>
            <button class="nav-tab" onclick="showTab('insights')">Insights</button>
        </div>

        <div id="trade-entry" class="tab-content active">
            <div class="form-section">
                <h3 id="formTitle">📝 New Trade Entry</h3>
                <form id="tradeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date & Time</label>
                            <input type="datetime-local" id="tradeDateTime" required>
                        </div>
                        <div class="form-group">
                            <label>Signal Type</label>
                            <select id="signalType" required>
                                <option value="">Select Signal</option>
                                <option value="buy">EMA 4 Cross Above EMA 12 (BUY)</option>
                                <option value="sell">EMA 4 Cross Below EMA 12 (SELL)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Entry Price</label>
                            <input type="number" id="entryPrice" step="0.01" placeholder="e.g., 2045.50" required>
                        </div>
                        <div class="form-group">
                            <label>Lot Size</label>
                            <input type="number" id="lotSize" step="0.01" placeholder="e.g., 0.05" required>
                        </div>
                        <div class="form-group">
                            <label>Stop Loss</label>
                            <input type="number" id="stopLoss" step="0.01" placeholder="e.g., 2025.50" required>
                        </div>
                        <div class="form-group">
                            <label>Take Profit</label>
                            <input type="number" id="takeProfit" step="0.01" placeholder="e.g., 2085.50" required>
                        </div>
                        <div class="form-group">
                            <label>Risk Amount ($)</label>
                            <input type="number" id="riskAmount" step="0.01" placeholder="e.g., 20.00" required>
                        </div>
                        <div class="form-group">
                            <label>Trade Status</label>
                            <select id="tradeStatus" required>
                                <option value="open">Open</option>
                                <option value="won">Won</option>
                                <option value="lost">Lost</option>
                                <option value="breakeven">Breakeven</option>
                            </select>
                        </div>
                        <div class="form-group" id="exitPriceGroup" style="display: none;">
                            <label>Exit Price</label>
                            <input type="number" id="exitPrice" step="0.01" placeholder="Actual exit price">
                        </div>
                        <div class="form-group" id="exitDateGroup" style="display: none;">
                            <label>Exit Date & Time</label>
                            <input type="datetime-local" id="exitDateTime">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Market Setup & Analysis</label>
                        <textarea id="marketSetup" placeholder="Describe the EMA crossover setup, trend direction, support/resistance levels, and any confluence factors..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Trade Notes</label>
                        <textarea id="tradeNotes" placeholder="Entry reasoning, market conditions, emotions, exit strategy..."></textarea>
                    </div>
                    <button type="submit" class="btn-primary" id="submitBtn">Add Trade</button>
                    <button type="button" class="btn-secondary" onclick="clearForm()">Clear Form</button>
                    <button type="button" class="btn-secondary" id="cancelEditBtn" onclick="cancelEdit()" style="display: none;">Cancel Edit</button>
                </form>
            </div>
        </div>

        <div id="open-trades" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Open Trades</h4>
                    <div class="value" id="openTradesCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Total Risk</h4>
                    <div class="value" id="totalRisk">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Potential Profit</h4>
                    <div class="value" id="potentialProfit">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Potential Loss</h4>
                    <div class="value" id="potentialLoss">$0.00</div>
                </div>
            </div>

            <div class="trades-table">
                <div class="table-controls">
                    <h3>📈 Open Positions</h3>
                    <button class="btn-success" onclick="exportToExcel('open')">📥 Export to Excel</button>
                </div>
                <table id="openTradesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Signal</th>
                            <th>Entry</th>
                            <th>Stop Loss</th>
                            <th>Take Profit</th>
                            <th>Lot Size</th>
                            <th>Risk ($)</th>
                            <th>R:R</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="openTradesTableBody">
                    </tbody>
                </table>
                <div id="openEmptyState" class="empty-state">
                    <h3>No open trades</h3>
                    <p>Add a new trade with status "Open" to see it here</p>
                </div>
            </div>
        </div>

        <div id="closed-trades" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Closed Trades</h4>
                    <div class="value" id="closedTradesCount">0</div>
                </div>
                <div class="stat-card">
                    <h4>Win Rate</h4>
                    <div class="value" id="winRate">0%</div>
                </div>
                <div class="stat-card">
                    <h4>Total P&L</h4>
                    <div class="value" id="totalPnL">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Best Trade</h4>
                    <div class="value" id="bestTrade">$0.00</div>
                </div>
            </div>

            <div class="trades-table">
                <div class="table-controls">
                    <h3>📊 Closed Positions</h3>
                    <div class="filter-group">
                        <label>Filter by Status:</label>
                        <select id="statusFilter" onchange="filterClosedTrades()">
                            <option value="all">All Closed</option>
                            <option value="won">Won Only</option>
                            <option value="lost">Lost Only</option>
                            <option value="breakeven">Breakeven Only</option>
                        </select>
                        <button class="btn-success" onclick="exportToExcel('closed')">📥 Export to Excel</button>
                    </div>
                </div>
                <table id="closedTradesTable">
                    <thead>
                        <tr>
                            <th>Entry Date</th>
                            <th>Exit Date</th>
                            <th>Signal</th>
                            <th>Entry</th>
                            <th>Exit</th>
                            <th>Lot Size</th>
                            <th>P&L</th>
                            <th>R:R</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="closedTradesTableBody">
                    </tbody>
                </table>
                <div id="closedEmptyState" class="empty-state">
                    <h3>No closed trades yet</h3>
                    <p>Complete some trades to see them here</p>
                </div>
            </div>
        </div>

        <div id="performance" class="tab-content">
            <div class="table-controls">
                <h3>📊 Performance Analysis</h3>
                <button class="btn-success" onclick="exportToExcel('performance')">📥 Export Performance to Excel</button>
            </div>
            
            <div class="chart-container">
                <h3>Equity Curve</h3>
                <div class="performance-chart" id="equityChart">
                    📈 Chart will appear here as you add trades
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Average Win</h4>
                    <div class="value" id="avgWin">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Average Loss</h4>
                    <div class="value" id="avgLoss">$0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Profit Factor</h4>
                    <div class="value" id="profitFactor">0.00</div>
                </div>
                <div class="stat-card">
                    <h4>Max Drawdown</h4>
                    <div class="value" id="maxDrawdown">$0.00</div>
                </div>
            </div>
        </div>

        <div id="insights" class="tab-content">
            <div class="insights-section">
                <h4>🎯 Strategy Performance Insights</h4>
                <div id="insightsContainer">
                    <div class="insight-item">
                        <strong>EMA Crossover Analysis:</strong> Track how many crossover signals resulted in profitable trades vs. false signals
                    </div>
                    <div class="insight-item">
                        <strong>Time of Day Performance:</strong> Monitor which trading sessions (London, NY, Asian) provide the best EMA crossover signals
                    </div>
                    <div class="insight-item">
                        <strong>Risk Management:</strong> Ensure you're maintaining consistent risk per trade (typically 1-3% of account)
                    </div>
                    <div class="insight-item">
                        <strong>Market Conditions:</strong> Note whether trending or ranging markets produce better EMA crossover results
                    </div>
                </div>
            </div>

            <div class="insights-section">
                <h4>📊 Key Metrics to Monitor</h4>
                <div id="keyMetrics">
                    <div class="insight-item">
                        <strong>Target Win Rate:</strong> Aim for 55-65% win rate with 1:2 risk-reward ratio
                    </div>
                    <div class="insight-item">
                        <strong>Risk-Reward Ratio:</strong> Maintain consistent 1:2 or better on most trades
                    </div>
                    <div class="insight-item">
                        <strong>Maximum Consecutive Losses:</strong> Monitor streaks to adjust position sizing if needed
                    </div>
                    <div class="insight-item">
                        <strong>Monthly Performance:</strong> Track monthly returns to ensure consistent profitability
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trade Details Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Trade Details</h2>
            <div id="tradeDetailsContent">
                <!-- Trade details will be populated here -->
            </div>
        </div>
    </div>

    <script>
        let trades = [];
        let currentEditingId = null;

        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update displays when switching tabs
            updateDisplays();
        }

        function clearForm() {
            document.getElementById('tradeForm').reset();
            currentEditingId = null;
            document.getElementById('formTitle').textContent = '📝 New Trade Entry';
            document.getElementById('submitBtn').textContent = 'Add Trade';
            document.getElementById('cancelEditBtn').style.display = 'none';
            document.getElementById('exitPriceGroup').style.display = 'none';
            document.getElementById('exitDateGroup').style.display = 'none';
            
            // Set current datetime
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('tradeDateTime').value = now.toISOString().slice(0, 16);
        }

        function cancelEdit() {
            clearForm();
        }

        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            currentEditingId = id;
            document.getElementById('formTitle').textContent = '✏️ Edit Trade';
            document.getElementById('submitBtn').textContent = 'Update Trade';
            document.getElementById('cancelEditBtn').style.display = 'inline-block';
            
            // Populate form with trade data
            document.getElementById('tradeDateTime').value = trade.dateTime;
            document.getElementById('signalType').value = trade.signalType;
            document.getElementById('entryPrice').value = trade.entryPrice;
            document.getElementById('lotSize').value = trade.lotSize;
            document.getElementById('stopLoss').value = trade.stopLoss;
            document.getElementById('takeProfit').value = trade.takeProfit;
            document.getElementById('riskAmount').value = trade.riskAmount;
            document.getElementById('tradeStatus').value = trade.status;
            document.getElementById('marketSetup').value = trade.marketSetup || '';
            document.getElementById('tradeNotes').value = trade.tradeNotes || '';
            
            if (trade.exitPrice) {
                document.getElementById('exitPrice').value = trade.exitPrice;
            }
            if (trade.exitDateTime) {
                document.getElementById('exitDateTime').value = trade.exitDateTime;
            }
            
            // Show exit fields if trade is closed
            toggleExitFields();
            
            // Switch to trade entry tab
            showTab('trade-entry');
        }

        function toggleExitFields() {
            const status = document.getElementById('tradeStatus').value;
            const exitPriceGroup = document.getElementById('exitPriceGroup');
            const exitDateGroup = document.getElementById('exitDateGroup');
            
            if (status === 'won' || status === 'lost' || status === 'breakeven') {
                exitPriceGroup.style.display = 'block';
                exitDateGroup.style.display = 'block';
            } else {
                exitPriceGroup.style.display = 'none';
                exitDateGroup.style.display = 'none';
            }
        }

        function viewTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            const modal = document.getElementById('tradeModal');
            const modalTitle = document.getElementById('modalTitle');
            const content = document.getElementById('tradeDetailsContent');
            
            modalTitle.textContent = `Trade Details - ${trade.signalType.toUpperCase()}`;
            
            const pnl = calculatePnL(trade);
            const riskReward = calculateRiskReward(trade);
            
            content.innerHTML = `
                <div class="trade-details">
                    <div class="detail-group">
                        <h4>Trade Information</h4>
                        <div class="detail-item">
                            <span class="detail-label">Entry Date:</span>
                            <span class="detail-value">${new Date(trade.dateTime).toLocaleString()}</span>
                        </div>
                        ${trade.exitDateTime ? `
                        <div class="detail-item">
                            <span class="detail-label">Exit Date:</span>
                            <span class="detail-value">${new Date(trade.exitDateTime).toLocaleString()}</span>
                        </div>` : ''}
                        <div class="detail-item">
                            <span class="detail-label">Signal Type:</span>
                            <span class="detail-value">
                                <span class="signal-indicator signal-${trade.signalType}">${trade.signalType.toUpperCase()}</span>
                            </span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Status:</span>
                            <span class="detail-value">
                                <span class="signal-indicator status-${trade.status}">${trade.status.toUpperCase()}</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="detail-group">
                        <h4>Price Levels</h4>
                        <div class="detail-item">
                            <span class="detail-label">Entry Price:</span>
                            <span class="detail-value">${parseFloat(trade.entryPrice).toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Stop Loss:</span>
                            <span class="detail-value">${parseFloat(trade.stopLoss).toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Take Profit:</span>
                            <span class="detail-value">${parseFloat(trade.takeProfit).toFixed(2)}</span>
                        </div>
                        ${trade.exitPrice ? `
                        <div class="detail-item">
                            <span class="detail-label">Exit Price:</span>
                            <span class="detail-value">${parseFloat(trade.exitPrice).toFixed(2)}</span>
                        </div>` : ''}
                    </div>
                    
                    <div class="detail-group">
                        <h4>Trade Metrics</h4>
                        <div class="detail-item">
                            <span class="detail-label">Lot Size:</span>
                            <span class="detail-value">${trade.lotSize}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Risk Amount:</span>
                            <span class="detail-value">${parseFloat(trade.riskAmount).toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Risk:Reward:</span>
                            <span class="detail-value">1:${riskReward.toFixed(2)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">P&L:</span>
                            <span class="detail-value ${pnl > 0 ? 'profit' : pnl < 0 ? 'loss' : 'neutral'}">${pnl.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
                
                ${trade.marketSetup ? `
                <div class="notes-section">
                    <h4>Market Setup & Analysis</h4>
                    <p>${trade.marketSetup}</p>
                </div>` : ''}
                
                ${trade.tradeNotes ? `
                <div class="notes-section">
                    <h4>Trade Notes</h4>
                    <p>${trade.tradeNotes}</p>
                </div>` : ''}
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('tradeModal').style.display = 'none';
        }

        function calculatePnL(trade) {
            const entryPrice = parseFloat(trade.entryPrice);
            const lotSize = parseFloat(trade.lotSize);
            const contractSize = 100; // 100 oz per standard lot
            let exitPrice;
            
            if (trade.status === 'won') {
                exitPrice = trade.exitPrice ? parseFloat(trade.exitPrice) : parseFloat(trade.takeProfit);
            } else if (trade.status === 'lost') {
                exitPrice = trade.exitPrice ? parseFloat(trade.exitPrice) : parseFloat(trade.stopLoss);
            } else if (trade.status === 'breakeven') {
                exitPrice = trade.exitPrice ? parseFloat(trade.exitPrice) : entryPrice;
            } else {
                return 0; // open trade
            }
            
            const pipDifference = trade.signalType === 'buy' ? 
                (exitPrice - entryPrice) : (entryPrice - exitPrice);
            return pipDifference * lotSize * contractSize;
        }

        function calculateRiskReward(trade) {
            const entryPrice = parseFloat(trade.entryPrice);
            const stopLoss = parseFloat(trade.stopLoss);
            const takeProfit = parseFloat(trade.takeProfit);
            
            const riskPips = Math.abs(entryPrice - stopLoss);
            const rewardPips = Math.abs(takeProfit - entryPrice);
            
            return riskPips > 0 ? (rewardPips / riskPips) : 0;
        }

        function exportToExcel(type) {
            let data = [];
            let filename = '';
            
            if (type === 'open') {
                data = trades.filter(t => t.status === 'open').map(trade => ({
                    'Date': new Date(trade.dateTime).toLocaleDateString(),
                    'Signal': trade.signalType.toUpperCase(),
                    'Entry Price': parseFloat(trade.entryPrice).toFixed(2),
                    'Stop Loss': parseFloat(trade.stopLoss).toFixed(2),
                    'Take Profit': parseFloat(trade.takeProfit).toFixed(2),
                    'Lot Size': trade.lotSize,
                    'Risk Amount': parseFloat(trade.riskAmount).toFixed(2),
                    'Risk Reward': '1:' + calculateRiskReward(trade).toFixed(2),
                    'Market Setup': trade.marketSetup || '',
                    'Trade Notes': trade.tradeNotes || ''
                }));
                filename = 'Open_Trades_' + new Date().toISOString().split('T')[0] + '.csv';
            } else if (type === 'closed') {
                data = trades.filter(t => t.status !== 'open').map(trade => ({
                    'Entry Date': new Date(trade.dateTime).toLocaleDateString(),
                    'Exit Date': trade.exitDateTime ? new Date(trade.exitDateTime).toLocaleDateString() : '',
                    'Signal': trade.signalType.toUpperCase(),
                    'Entry Price': parseFloat(trade.entryPrice).toFixed(2),
                    'Exit Price': trade.exitPrice ? parseFloat(trade.exitPrice).toFixed(2) : 
                                 (trade.status === 'won' ? trade.takeProfit : trade.status === 'lost' ? trade.stopLoss : trade.entryPrice),
                    'Lot Size': trade.lotSize,
                    'P&L': calculatePnL(trade).toFixed(2),
                    'Risk Reward': '1:' + calculateRiskReward(trade).toFixed(2),
                    'Status': trade.status.toUpperCase(),
                    'Market Setup': trade.marketSetup || '',
                    'Trade Notes': trade.tradeNotes || ''
                }));
                filename = 'Closed_Trades_' + new Date().toISOString().split('T')[0] + '.csv';
            } else if (type === 'performance') {
                const closedTrades = trades.filter(t => t.status !== 'open');
                const winningTrades = closedTrades.filter(t => t.status === 'won');
                const losingTrades = closedTrades.filter(t => t.status === 'lost');
                const totalPnL = closedTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0);
                const winRate = closedTrades.length > 0 ? (winningTrades.length / closedTrades.length * 100) : 0;
                
                data = [{
                    'Total Trades': closedTrades.length,
                    'Winning Trades': winningTrades.length,
                    'Losing Trades': losingTrades.length,
                    'Breakeven Trades': closedTrades.filter(t => t.status === 'breakeven').length,
                    'Win Rate (%)': winRate.toFixed(2),
                    'Total P&L': totalPnL.toFixed(2),
                    'Average Win': winningTrades.length > 0 ? (winningTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0) / winningTrades.length).toFixed(2) : '0.00',
                    'Average Loss': losingTrades.length > 0 ? (Math.abs(losingTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0)) / losingTrades.length).toFixed(2) : '0.00',
                    'Best Trade': closedTrades.length > 0 ? Math.max(...closedTrades.map(calculatePnL)).toFixed(2) : '0.00',
                    'Worst Trade': closedTrades.length > 0 ? Math.min(...closedTrades.map(calculatePnL)).toFixed(2) : '0.00'
                }];
                filename = 'Performance_Summary_' + new Date().toISOString().split('T')[0] + '.csv';
            }
            
            if (data.length === 0) {
                alert('No data to export');
                return;
            }
            
            // Convert to CSV
            const csvContent = convertToCSV(data);
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvHeaders = headers.join(',');
            
            const csvRows = data.map(row => 
                headers.map(header => {
                    const value = row[header];
                    return typeof value === 'string' && value.includes(',') ? `"${value}"` : value;
                }).join(',')
            );
            
            return csvHeaders + '\n' + csvRows.join('\n');
        }

        function filterClosedTrades() {
            const filter = document.getElementById('statusFilter').value;
            updateClosedTradesTable(filter);
        }

        document.getElementById('tradeStatus').addEventListener('change', toggleExitFields);

        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const trade = {
                id: currentEditingId || Date.now(),
                dateTime: document.getElementById('tradeDateTime').value,
                signalType: document.getElementById('signalType').value,
                entryPrice: document.getElementById('entryPrice').value,
                lotSize: document.getElementById('lotSize').value,
                stopLoss: document.getElementById('stopLoss').value,
                takeProfit: document.getElementById('takeProfit').value,
                riskAmount: document.getElementById('riskAmount').value,
                status: document.getElementById('tradeStatus').value,
                marketSetup: document.getElementById('marketSetup').value,
                tradeNotes: document.getElementById('tradeNotes').value,
                exitPrice: document.getElementById('exitPrice').value || null,
                exitDateTime: document.getElementById('exitDateTime').value || null
            };
            
            if (currentEditingId) {
                // Update existing trade
                const index = trades.findIndex(t => t.id === currentEditingId);
                if (index !== -1) {
                    trades[index] = trade;
                    alert('Trade updated successfully!');
                }
            } else {
                // Add new trade
                trades.push(trade);
                alert('Trade added successfully!');
            }
            
            updateDisplays();
            clearForm();
        });

        function deleteTrade(id) {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(trade => trade.id !== id);
                updateDisplays();
            }
        }

        function updateDisplays() {
            updateOpenTradesTable();
            updateClosedTradesTable();
            updateStats();
            updatePerformanceMetrics();
        }

        function updateOpenTradesTable() {
            const openTrades = trades.filter(t => t.status === 'open');
            const tbody = document.getElementById('openTradesTableBody');
            const emptyState = document.getElementById('openEmptyState');
            
            if (openTrades.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                tbody.innerHTML = openTrades.map(trade => {
                    const riskReward = calculateRiskReward(trade);
                    return `
                        <tr>
                            <td>${new Date(trade.dateTime).toLocaleDateString()}</td>
                            <td><span class="signal-indicator signal-${trade.signalType}">${trade.signalType.toUpperCase()}</span></td>
                            <td>${parseFloat(trade.entryPrice).toFixed(2)}</td>
                            <td>${parseFloat(trade.stopLoss).toFixed(2)}</td>
                            <td>${parseFloat(trade.takeProfit).toFixed(2)}</td>
                            <td>${trade.lotSize}</td>
                            <td>${parseFloat(trade.riskAmount).toFixed(2)}</td>
                            <td>1:${riskReward.toFixed(2)}</td>
                            <td class="action-buttons">
                                <button class="edit-btn" onclick="editTrade(${trade.id})">Edit</button>
                                <button class="view-btn" onclick="viewTrade(${trade.id})">View</button>
                                <button class="delete-btn" onclick="deleteTrade(${trade.id})">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update open trades stats
            const totalRisk = openTrades.reduce((sum, trade) => sum + parseFloat(trade.riskAmount), 0);
            const potentialProfit = openTrades.reduce((sum, trade) => {
                const entryPrice = parseFloat(trade.entryPrice);
                const takeProfit = parseFloat(trade.takeProfit);
                const lotSize = parseFloat(trade.lotSize);
                const contractSize = 100;
                const pipDifference = trade.signalType === 'buy' ? 
                    (takeProfit - entryPrice) : (entryPrice - takeProfit);
                return sum + (pipDifference * lotSize * contractSize);
            }, 0);
            const potentialLoss = openTrades.reduce((sum, trade) => {
                const entryPrice = parseFloat(trade.entryPrice);
                const stopLoss = parseFloat(trade.stopLoss);
                const lotSize = parseFloat(trade.lotSize);
                const contractSize = 100;
                const pipDifference = trade.signalType === 'buy' ? 
                    (stopLoss - entryPrice) : (entryPrice - stopLoss);
                return sum + (pipDifference * lotSize * contractSize);
            }, 0);
            
            document.getElementById('openTradesCount').textContent = openTrades.length;
            document.getElementById('totalRisk').textContent = `${totalRisk.toFixed(2)}`;
            document.getElementById('potentialProfit').textContent = `${potentialProfit.toFixed(2)}`;
            document.getElementById('potentialLoss').textContent = `${Math.abs(potentialLoss).toFixed(2)}`;
        }

        function updateClosedTradesTable(filter = 'all') {
            let closedTrades = trades.filter(t => t.status !== 'open');
            
            if (filter !== 'all') {
                closedTrades = closedTrades.filter(t => t.status === filter);
            }
            
            const tbody = document.getElementById('closedTradesTableBody');
            const emptyState = document.getElementById('closedEmptyState');
            
            if (closedTrades.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
                tbody.innerHTML = closedTrades.map(trade => {
                    const pnl = calculatePnL(trade);
                    const riskReward = calculateRiskReward(trade);
                    const pnlClass = pnl > 0 ? 'profit' : pnl < 0 ? 'loss' : 'neutral';
                    const exitPrice = trade.exitPrice ? parseFloat(trade.exitPrice) : 
                                     (trade.status === 'won' ? parseFloat(trade.takeProfit) : 
                                      trade.status === 'lost' ? parseFloat(trade.stopLoss) : parseFloat(trade.entryPrice));
                    
                    return `
                        <tr>
                            <td>${new Date(trade.dateTime).toLocaleDateString()}</td>
                            <td>${trade.exitDateTime ? new Date(trade.exitDateTime).toLocaleDateString() : '-'}</td>
                            <td><span class="signal-indicator signal-${trade.signalType}">${trade.signalType.toUpperCase()}</span></td>
                            <td>${parseFloat(trade.entryPrice).toFixed(2)}</td>
                            <td>${exitPrice.toFixed(2)}</td>
                            <td>${trade.lotSize}</td>
                            <td class="${pnlClass}">${pnl.toFixed(2)}</td>
                            <td>1:${riskReward.toFixed(2)}</td>
                            <td><span class="signal-indicator status-${trade.status}">${trade.status.toUpperCase()}</span></td>
                            <td class="action-buttons">
                                <button class="view-btn" onclick="viewTrade(${trade.id})">View</button>
                                <button class="delete-btn" onclick="deleteTrade(${trade.id})">Delete</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        function updateStats() {
            const closedTrades = trades.filter(t => t.status !== 'open');
            const wonTrades = closedTrades.filter(t => t.status === 'won');
            const winRate = closedTrades.length > 0 ? ((wonTrades.length / closedTrades.length) * 100).toFixed(1) : '0';
            
            const totalPnL = closedTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0);
            const bestTrade = closedTrades.length > 0 ? Math.max(...closedTrades.map(calculatePnL)) : 0;
            
            document.getElementById('closedTradesCount').textContent = closedTrades.length;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('totalPnL').textContent = `${totalPnL.toFixed(2)}`;
            document.getElementById('bestTrade').textContent = `${bestTrade.toFixed(2)}`;
        }

        function updatePerformanceMetrics() {
            const closedTrades = trades.filter(t => t.status !== 'open');
            const winningTrades = closedTrades.filter(t => t.status === 'won');
            const losingTrades = closedTrades.filter(t => t.status === 'lost');
            
            const avgWin = winningTrades.length > 0 ? 
                winningTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0) / winningTrades.length : 0;
            
            const avgLoss = losingTrades.length > 0 ? 
                Math.abs(losingTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0) / losingTrades.length) : 0;
            
            const totalWins = winningTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0);
            const totalLosses = Math.abs(losingTrades.reduce((sum, trade) => sum + calculatePnL(trade), 0));
            
            const profitFactor = totalLosses > 0 ? (totalWins / totalLosses) : 0;
            
            // Simple max drawdown calculation
            let runningTotal = 0;
            let peak = 0;
            let maxDrawdown = 0;
            
            closedTrades.forEach(trade => {
                runningTotal += calculatePnL(trade);
                if (runningTotal > peak) {
                    peak = runningTotal;
                }
                const drawdown = peak - runningTotal;
                if (drawdown > maxDrawdown) {
                    maxDrawdown = drawdown;
                }
            });
            // Save to localStorage
localStorage.setItem('trades', JSON.stringify(trades));

// Load from localStorage
const savedTrades = localStorage.getItem('trades');
if (savedTrades) {
    trades = JSON.parse(savedTrades);
}
            document.getElementById('avgWin').textContent = `${avgWin.toFixed(2)}`;
            document.getElementById('avgLoss').textContent = `${avgLoss.toFixed(2)}`;
            document.getElementById('profitFactor').textContent = profitFactor.toFixed(2);
            document.getElementById('maxDrawdown').textContent = `${maxDrawdown.toFixed(2)}`;
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('tradeModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            clearForm();
            updateDisplays();
        });
    </script>
</body>
</html>
